var DatabaseAccess = require("prometheus-database-accessor");

var MetadataManager = new function(){
	this.getValue = function(key, callback){
		DatabaseAccess.query("meta", "find", { key: key }, {}).then(function(response){
			if(response.length==0){
				callback(undefined);
			}else{
				callback(response[0].value);
			}
		});
	}
	
	this.hasKey = function(key, callback){
		DatabaseAccess.query("meta", "find", { key: key }, {}).then(function(response){
			if(response.length==0){
				callback(false);
			}else{
				callback(true);
			}
		});
	}

	this.setValue = function(key, value, callback){
		DatabaseAccess.query("meta", "update", { key: key }, {key:key, value: value}).then(function(response){
			if(response.length==0){
				callback(false);
			}else{
				callback(true);
			}
		});	
	}

	this.increment = function(key, callback){
		this.getValue(key, function(data){
			this.setValue(key, data++, function(data){
				callback(data);
			})
		})
	}
}

module.exports = MetadataManager;