var DatabaseAccess = require("prometheus-database-accessor");

var resource_manager = new function(){
	this.say = function(){
		console.log("lol");
	}

	this.getFirstFreeID = function(callback){
		DatabaseAccess.query("meta", "find", { key: "next_free_id" }, {}).then(function(response){
			console.log("getFirstFreeID: ",response);
			if (response.length == 0) {
				console.log("Doesn't exits.");
				DatabaseAccess.query("meta", "insert", { key: "next_free_id", value: 0}, {}).then(function(response) {
					callback(response);
					console.log("Created.");
				})
			}
			else {
				console.log(response);
			}
			callback(response);

		});
	}

	this.newResource = function(type, value, callback, id){
		type = type.toString();
		DatabaseAccess.query("resources", "insert", {type: type, body: value }, {}).then(function(data){
			callback(data);
		});
	}

	this.getResourceByID = function(resource_id, callback){
		console.log("inside getResourceByID");
		DatabaseAccess.query("resources", "find", { _id: resource_id }, {}).then(function(response){
			callback(response);
		})
	}
}

module.exports = resource_manager;