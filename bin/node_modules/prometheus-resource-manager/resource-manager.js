var DatabaseAccess = require("prometheus-database-accessor");
var metadata = require('prometheus-metadata-manager');

var resource_manager = new function(){
	this.say = function(){
		console.log("lol");
	}

	this.getFirstFreeID = function(callback){
		metadata.getValue("next_free_id", function(value) {
			if (value == undefined) {
				metadata.setValue("next_free_id", 0, function() {
					callback(0);
				})
			}
			else {
				callback(value);
			}
		})
	}

	this.newResource = function(type, value, callback){
		type = type.toString();
		console.log("newResource");
		metadata.increment("next_free_id", function(newID) {
			DatabaseAccess.query("resources", "insert", {prometheus_id: newID, type: type, body: value }, {}).then(function(data){
				callback(data);
				console.log("JestÄ™ tutaj");
			});
		});
}

this.getResourceByID = function(resource_id, callback){
	console.log("inside getResourceByID");
	DatabaseAccess.query("resources", "find", { _id: resource_id }, {}).then(function(response){
		callback(response);
	})
}
}

module.exports = resource_manager;