module.exports = function(http_session, dispatcher, dependencies) {
	var www_server = dependencies["channel.www_server"];
	var sessionManager = dependencies["service.session_manager"];

	www_server.route({
		method: "POST", 
		path: "/login",
		handler: function(request, reply) {
			dispatcher.users_password_match(request.payload.username, request.payload.password).then(function(user_id){
				if (user_id){
					var sessionId = sessionManager.new_session(user_id);
					reply("http_session: Logged in!").state('PrometheusSession', sessionId).redirect('http://localhost/user.html#'+user_id);
				}else{
					reply("Password incorrect.")
				}
			});
		}
	});

	www_server.route({
	method: "GET", 
	path: "/login",
	handler: function(request, reply) {
			dispatcher.users_password_match(request.payload.username, request.payload.password).then(function(response){
				if (response){
					var sessionId = sessionManager.new_session(request.payload.username);
					reply("http_session: Logged in!").state('PrometheusSession', sessionId).redirect('http://localhost');;
				}else{
					reply("Password incorrect.")
				}
			});
		}
	});

	www_server.route({
		method: "POST",
		path: "/logout",
		handler: function(request,reply) {

			//sessionManager.kill_session(request.)
			sessionManager.kill_session(request.state.PrometheusSession);
			reply("You have been logged out!");
		}
	});
}