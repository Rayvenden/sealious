var sha1 = require("sha1");
//var microtime = require("microtime");

module.exports = function(session_manager){
	var session_id_to_user_id = {};
	//póki co hashe sesji sa trzymane tylko w RAMie. Być może trzeba będzie je trzymac w pliku (albo w plikach!) na dysku.

	function generate_session_id(){
		//var seed = microtime.now().toString() + Math.random().toString();
		var seed = Math.random().toString();
		var session_id = sha1(seed);
		return session_id;
	}

	function new_session(user_id){
		var session_id = generate_session_id();
		session_id_to_user_id[session_id] = user_id;
		return session_id;
	}

	function kill_session(session_id){
		delete session_id_to_user_id[session_id];
	}

	function get_user_id(session_id){
		if(session_id_to_user_id[session_id]){
			return session_id_to_user_id[session_id];
		}
		return false;
	}

	session_manager.new_session = new_session;
	session_manager.kill_session = kill_session;
	session_manager.get_user_id = get_user_id;
}