var UserManager = new function(){
	this.create_user = function(username, password, dispatcher){
		return dispatcher.resources_create("user_data", {})
			.then(function(user_data_resource){
				var body = {
					username: username, 
					password: password, 
					userdata_id: user_data_resource.id
				};
				return dispatcher.database_query("users", "insert", body);
			})		
	}

	this.user_exists = function(username, dispatcher){
		return new Promise(function(resolve, reject){
			dispatcher.database_query("users", "find", {username: username})
			.then(function(result){
				resolve(result.length===1);
			});			
		})
	}

	this.password_match = function(username, password, dispatcher){
		username = username.toString();
		password = password.toString();
		return new Promise(function(resolve, reject){
			dispatcher.database_query("users", "find", {username: username, password: password})
			.then(function(result){
				resolve(result.length===1);
			})			
		})
	}

	this.get_user_data = function(username, dispatcher){
		return new Promise(function(resolve, reject){
			dispatcher.database_query("users", "find", {username: username})
				.then(function(result){
					userdata_id = result.userdata_id;
					return dispatcher.resources_get_by_id(userdata_id);
				})
				.then(function(userdata){
					userdata.username = username;
					resolve(userdata);
				})			
		})
	}

}

module.exports = UserManager;