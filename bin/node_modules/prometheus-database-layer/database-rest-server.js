var config = require("prometheus-config")
var Hapi = require('hapi');
var DatabaseAccess = require("prometheus-database-accessor");

var server = new Hapi.Server(config.db_layer_config.port);

server.route({
    method: 'GET',
    path: '/',
    handler: function (request, reply) {
        reply('jestę serwerę 1');
    }
});


server.route({
    method: 'GET',
    path: '/api/rest/v1/{collection_name}/',
    handler: function (request, reply) {
        var collection_name = request.params.collection_name;
        var query = request.params.query;
        var options = request.params.options;
        console.log("request for resource");
        console.log(DatabaseAccess);
        DatabaseAccess.query(collection_name, "find", query, options).then(function(data){
            reply(data);
        })
    }  
});

server.route({
    method: 'POST',
    path: '/api/rest/v1/resource/{resource_type}/',
    handler: function (request, reply) {
        console.log("post_request");
        var resource_type = request.params.resource_type;
        Database.createResource(resource_type, request.payload).then(function(){
            reply("OK!");            
        });
    }  
});

/*
server.start(function () {
    console.log('Server running at:', server.info.uri);
});

*/

module.exports = server;