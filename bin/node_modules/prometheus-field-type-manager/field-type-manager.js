var path = require("path");
var fs = require("fs");
var FieldType = require("prometheus-field-type");

var FieldTypeManager = new function(){
	var all_field_types_by_name = [];

	this.addFieldType = function(field_type){
		if(!(field_type instanceof FieldType)){
			var err = new Error("===FieldTypeManager error=== argument passed to addFieldType is not an instance of FieldType");
			err.code = "not_a_field_type_instance";
			throw err;
		}
		
		all_field_types_by_name[field_type.name] = field_type;
	}

	this.getFieldTypeByName = function(field_type_name){
		return all_field_types_by_name[field_type_name] || null;
	}
}

/*
	Get field types from ./types
*/
var field_types_dir = path.resolve(__dirname, "./types");
var field_types_dir_contents = fs.readdirSync(field_types_dir);
for(var i in field_types_dir_contents){
	var current_type_path = path.resolve(field_types_dir, field_types_dir_contents[i]);
	var field_type_object = require(current_type_path);
	FieldTypeManager.addFieldType(field_type_object);
}

module.exports = FieldTypeManager;