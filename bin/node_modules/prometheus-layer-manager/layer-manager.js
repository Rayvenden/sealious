var simpleargs = require("simpleargs");
var Modules = require("prometheus-module-manager");

var LayerManager = new function(){

	this.mode = null;

	this.isLocal = function(){
		var l_argument = simpleargs(process.argv.slice(2))["l"]
		return l_argument==="local" || l_argument===null || l_argument==undefined;
	}

	this.getLayer = function(){
		var l_argument = simpleargs(process.argv.slice(2))["l"]
		if(!l_argument){
			return null;
		}else{
			return l_argument;
		}
	}

	this.init = function(){
		var l_argument = simpleargs(process.argv.slice(2))["l"]
		this.mode = l_argument? l_argument : "local";
		if(this.isLocal()){
			for(var i in layers){
				layers[i].init();
			}
			Modules.execute_modules(["services", "channels"]);
		}else{
			switch(this.getLayer()){
				case "db":
					db_layer.init();
					break;
				case "biz":
					biz_layer.init();
					Modules.execute_modules(["services"]);
					break;
				case "web":
					web_layer.init();
					Modules.execute_modules(["channels"]);
					break;
			}
		}
	}

}

module.exports = LayerManager;

var web_layer = require("prometheus-web-layer");
var biz_layer = require("prometheus-business-layer");
var db_layer = require("prometheus-database-layer");

var layers = {
	"db": db_layer,
	"web": web_layer,
	"biz": biz_layer,
}